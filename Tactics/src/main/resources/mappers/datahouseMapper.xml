<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="datahouseMapper">
	
	<select id="list" resultType="com.spring.vo.DatahouseVO">
		SELECT LNAME, TNAME, POS, BNO, NAME FROM TACTICS_DATAHOUSE
		ORDER BY BNO ASC
	</select>

	<select id="listPage" resultType="com.spring.vo.DatahouseVO" parameterType="com.spring.vo.SearchCriteria">
		SELECT LNAME, TNAME, POS, BNO, NAME
		FROM (SELECT PNO, LNAME, TNAME, POS, BNO, NAME, ROW_NUMBER() OVER(ORDER BY PNO DESC) AS RNUM
		      FROM TACTICS_DATAHOUSE
		      WHERE 1=1 <include refid="search"></include>) TACTICS
		WHERE RNUM BETWEEN #{rowStart} AND #{rowEnd}
		ORDER BY PNO DESC
	</select>
	
	<select id="listCount" parameterType="com.spring.vo.SearchCriteria" resultType="int">
		SELECT COUNT(PNO)
		   FROM TACTICS_DATAHOUSE
		   WHERE 1=1
		<include refid="search"></include>	
		   AND PNO > 0
	</select>
	
	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 'l'.toString()">AND LNAME LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 't'.toString()">AND TNAME LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'n'.toString()">AND NAME LIKE '%' || #{keyword} || '%'</if>
		</if>
	</sql>
</mapper>